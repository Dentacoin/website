var initAddressSuggesters,checkAddress,setupMap,mapsLoaded=!0,mapsWaiting=[],stopThirdRegistrationStep=!1,prepareMapFunction=function(e){mapsLoaded?e():mapsWaiting.push(e)};$(document).ready(function(e){setupMap=function(e,t){if(console.log("setupMap"),e.find(".suggester-map-div").show(),e.find(".suggester-map-div").attr("inited"))e.find(".suggester-map-div").data("map").panTo(t),e.find(".suggester-map-div").data("marker").setPosition(t);else{var n=new google.maps.Map(e.find(".suggester-map-div")[0],{center:t,zoom:14,backgroundColor:"none"}),s=new google.maps.Marker({map:n,icon:"https://dentacoin.com/assets/images/map-pin-inactive.png",draggable:!0,position:t});s.addListener("dragend",function(t){this.map.panTo(this.getPosition()),(new google.maps.Geocoder).geocode({location:this.getPosition()},function(e,t){if("OK"==t){var n=e[0].formatted_address,s=this.find(".country-select option:selected").text();n=n.replace(", "+s,""),this.find(".address-suggester").val(n).blur()}else checkAddress(null,this)}.bind(e))}),e.find(".suggester-map-div").attr("inited",1),e.find(".suggester-map-div").data("map",n),e.find(".suggester-map-div").data("marker",s)}},initAddressSuggesters=function(){console.log("initAddressSuggesters"),prepareMapFunction(function(){e(".address-suggester").each(function(){var t=e(this).closest(".address-suggester-wrapper");if(t.find(".country-select").change(function(){var t=e(this).find("option:selected").val();d.setComponentRestrictions({country:t})}),t.find(".suggester-map-div").attr("lat")){var n={lat:parseFloat(t.find(".suggester-map-div").attr("lat")),lng:parseFloat(t.find(".suggester-map-div").attr("lon"))};setupMap(t,n)}var s=e(this)[0],i=t.find(".country-select option:selected").val();null==i&&e("#hidden-country-code").length&&(i=e("#hidden-country-code").val());var o={componentRestrictions:{country:i},types:["address"]},d=new google.maps.places.Autocomplete(s,o);d.suggester_container=t,google.maps.event.addListener(d,"place_changed",function(){var e=this.getPlace();this.suggester_container.find(".address-suggester").val(e.formatted_address?e.formatted_address:e.name).blur()}.bind(d)),e(this).blur(function(t){var n=e(this).closest(".address-suggester-wrapper"),s=n.find(".country-select option:selected").text();null==s&&e("#hidden-country-name").length&&(s=e("#hidden-country-name").val());var i=n.find(".country-select option:selected").val();null==i&&e("#hidden-country-code").length&&(i=e("#hidden-country-code").val());var o=new google.maps.Geocoder,d=e(this).val();o.geocode({address:d,region:i},function(e,t){checkAddress("OK"==t?e[0]:null,this)}.bind(n))})})}),e(".address-suggester").on("keyup keypress",function(e){if(13===(e.keyCode||e.which))return e.preventDefault(),!1})},checkAddress=function(t,n){if(n.find(".geoip-hint").hide(),n.find(".geoip-confirmation").hide(),n.find(".different-country-hint").hide(),n.find(".suggester-map-div").hide(),t&&hasOwnProperty.call(t,"geometry")&&t.geometry){var s=n.find(".address-suggester").val(),i=n.find(".country-select option:selected").text();null==i&&e("#hidden-country-name").length&&(i=e("#hidden-country-name").val());var o,d=n.find(".country-select option:selected").val();for(var a in null==d&&e("#hidden-country-code").length&&(d=e("#hidden-country-code").val()),t.address_components)for(var r in t.address_components[a].types)if("country"==t.address_components[a].types[r]){o=t.address_components[a].short_name;break}if("XK"==d&&("XK"==o||void 0===o)||o.toLowerCase()==d.toLowerCase()){stopThirdRegistrationStep=!1,s=s.replace(", "+i,""),n.find(".address-suggester").val(s);var c={lat:t.geometry.location.lat(),lng:t.geometry.location.lng()};setupMap(n,c),n.find(".geoip-confirmation").show()}else stopThirdRegistrationStep=!0,n.find(".different-country-hint").show()}else stopThirdRegistrationStep=!0,n.find(".geoip-hint").show()},e(".init-address-suggester").length&&initAddressSuggesters()});
